function u(t,r=!1){function o(e,s){if(r){let i=t.state[e];s(e,i)}let c=t.trackStore,n=c[e];n||(n=c[e]=new Set),n.add(s)}return(e,s)=>{if(Array.isArray(e))for(let c of e)o(c,s);else o(e,s)}}function m({trackStore:t}){function r(o,e){let s=t[o];!s||s.delete(e)}return(o,e)=>{if(Array.isArray(o))for(let s of o)r(s,e);else r(o,e)}}function g(t,r){let{trackStore:o}=t,e=t.state[r],s=o[r];if(!!s)for(let c of s)c(r,e)}var y=!1,A=null;function h(t,r){let{state:o,actions:e}=t;return new Proxy(t,{get(c,n){if(n in t)return t[n];if(n in r)return r[n];if(n in o)return o[n];if(n in e)return e[n];throw new Error(`\u4E0D\u80FD\u83B7\u53D6 ${n}`)},set(c,n,i){if(n in r)throw new Error(`${n} \u662F Store \u81EA\u5E26\u7684\u65B9\u6CD5\u4E0D\u5141\u8BB8\u88AB\u4FEE\u6539`);if(n in o)return o[n]=i,!0;throw n in e?new Error(`${n} \u662F actions \u7684\u65B9\u6CD5, \u4E0D\u5141\u8BB8\u88AB\u4FEE\u6539`):new Error(`${n} \u8BF7\u5728\u521B\u5EFA Store \u65F6\u6DFB\u52A0\u5230 State \u6216 Actions \u4E2D`)}})}function I(t,r,o=null){let{isDeepWatch:e}=t.options;return new Proxy(r,{set(s,c,n){if(s[c]===n)return!0;if(!e)s[c]=n;else{if(e&&y)return s[c]=n,!0;e&&typeof n=="object"&&n!==null&&(A=o??c,s[c]=l(t,n),A=null)}return g(t,o??c),!0}})}function l(t,r,o=!1){let e=Array.isArray(r)?[]:{};function s(c,n,i=!1){for(let f in c){let a=c[f];if(i&&(A=f),typeof a=="object"&&a!==null){let d=Array.isArray(a)?[]:{};s(a,d),n[f]=I(t,d,A)}else n[f]=a;i&&(A=null)}}return y=!0,s(r,e,o),y=!1,I(t,e,o?null:A)}var O=0;function j(t,r){let{isDeepWatch:o}=t.options;return o?l(t,r,!0):I(t,r)}function p(t,r,o){let e={id:O++,trackStore:{},state:{},actions:r,options:o};return e.state=j(e,t),e}function k(t){return{watch:u(t),watchEffect:u(t,!0),deleteWatch:m(t)}}function w(t){for(let r in t)if(typeof t[r]!="function")throw new Error("actions \u91CC\u53EA\u80FD\u653E\u51FD\u6570")}function b(t){if(t===null||typeof t!="object")throw new Error("state \u5FC5\u987B\u662F\u5BF9\u8C61")}function x(t,r={}){let o=t.state??{},e=t.actions??{};b(o),w(e);let s=p(o,e,r),c=k(s);return h(s,c)}var S=x({state:{userInfo:{name:"hxl",age:18},books:[{id:100,name:"JS\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:88},{id:101,name:"Vue\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:99},{id:102,name:"React\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:87}]},actions:{changeUserInfoAction(){this.userInfo={name:"coderhxl",age:18}},changeBookPriceAction(){this.books[0].price=99}}},{isDeepWatch:!0});function P(t,r){console.log("getUserInfo",t,r)}function R(t,r){console.log("getBooks",t,r)}console.log(S.userInfo);console.log(S.books);S.watch("userInfo",P);S.watch("books",R);console.log("------------------------------");S.changeUserInfoAction();S.changeBookPriceAction();
