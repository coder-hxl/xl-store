function u(t,r=!1){function o(n,s){if(r){let c=t.state[n];s(n,c)}let i=t.trackStore,e=i[n];e||(e=i[n]=new Set),e.add(s)}return(n,s)=>{if(Array.isArray(n))for(let i of n)o(i,s);else o(n,s)}}function h({trackStore:t}){function r(o,n){let s=t[o];!s||s.delete(n)}return(o,n)=>{if(Array.isArray(o))for(let s of o)r(s,n);else r(o,n)}}function l(t,r){let{trackStore:o}=t,n=t.state[r],s=o[r];if(!!s)for(let i of s)i(r,n)}var x=!1,S=null;function k(t,r){let{state:o,actions:n}=t;return new Proxy(t,{get(i,e){if(e in t)return t[e];if(e in r)return r[e];if(e in o)return o[e];if(e in n)return n[e];throw new Error(`\u4E0D\u80FD\u83B7\u53D6 ${e}`)},set(i,e,c){if(e in r)throw new Error(`${e} \u662F Store \u81EA\u5E26\u7684\u65B9\u6CD5\u4E0D\u5141\u8BB8\u88AB\u4FEE\u6539`);if(e in o)return o[e]=c,!0;throw e in n?new Error(`${e} \u662F actions \u7684\u65B9\u6CD5, \u4E0D\u5141\u8BB8\u88AB\u4FEE\u6539`):new Error(`${e} \u8BF7\u5728\u521B\u5EFA Store \u65F6\u6DFB\u52A0\u5230 State \u6216 Actions \u4E2D`)}})}function y(t,r,o=null){let{isDeepWatch:n}=t.options;return new Proxy(r,{set(s,i,e){return s[i]===e?!0:x?(s[i]=e,!0):(n&&typeof e=="object"&&e!==null?(S=o||i,s[i]=d(t,e),S=null):s[i]=e,o?l(t,o):l(t,i),!0)}})}function d(t,r,o=!1){let{isDeepWatch:n}=t.options,s={};Array.isArray(r)&&(s=[]);function i(e,c,g=!1){for(let f in e){let a=e[f];if(g&&(S=f),typeof a=="object"&&a!==null){let I={};Array.isArray(a)&&(I=[]),i(a,I),c[f]=y(t,I,S)}else c[f]=a;g&&(S=null)}}return n?(x=!0,i(r,s,o),x=!1):s=r,o?y(t,s):y(t,s,S)}var j=0;function p(t,r,o){let n={id:j++,trackStore:{},state:{},actions:r,options:o};return n.state=d(n,t,!0),n}function w(t){return{watch:u(t),watchEffect:u(t,!0),deleteWatch:h(t)}}function b(t){for(let r in t)if(typeof t[r]!="function")throw new Error("actions \u91CC\u53EA\u80FD\u653E\u51FD\u6570")}function O(t){if(t===null||typeof t!="object")throw new Error("state \u5FC5\u987B\u662F\u5BF9\u8C61")}function m(t,r={}){let o=t.state,n=t.actions;O(o),b(n);let s=p(o,n,r),i=w(s);return k(s,i)}var A=m({state:{userInfo:{name:"hxl",age:18},books:[{id:100,name:"JS\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:88},{id:101,name:"Vue\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:99},{id:102,name:"React\u9AD8\u7EA7\u7A0B\u5E8F\u8BBE\u8BA1",price:87}]},actions:{changeUserInfoAction(){this.userInfo={name:"coderhxl",age:18}},changeBookPriceAction(){this.books[0].price=99}}},{isDeepWatch:!0});function P(t,r){console.log("getUserInfo",t,r)}function R(t,r){console.log("getBooks",t,r)}console.log(A.userInfo);console.log(A.books);A.watch("userInfo",P);A.watch("books",R);console.log("------------------------------");A.changeUserInfoAction();A.changeBookPriceAction();
